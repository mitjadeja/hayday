<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hay Day Order Manager</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{background:#0f172a;color:#e5e7eb;font-family:Arial;padding:10px}
h1{text-align:center}
.card{background:#020617;border-radius:10px;padding:12px;margin-bottom:12px}
input,textarea,button{width:100%;padding:10px;margin:6px 0;border-radius:6px;border:none}
button{background:#22c55e;font-weight:bold}
button.gray{background:#475569}
button.danger{background:#ef4444;color:#fff}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{border-bottom:1px solid #334155;padding:6px;text-align:center}
.stat{display:flex;justify-content:space-between;font-size:14px;padding:4px 0}

#popup{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);padding:10px}
.popupBox{background:#020617;padding:10px;border-radius:10px;max-width:650px;margin:auto;max-height:90vh;overflow-y:auto}
h4{margin:6px 0}
</style>
</head>

<body>

<h1>Hay Day Order Manager</h1>

<div class="card">
<input id="customerName" placeholder="Customer Name">
<textarea id="tags" rows="5" placeholder="Paste tags (one per line)"></textarea>
<button id="sendBtn">Add / Send Tags</button>
</div>

<div class="card" id="stats"></div>

<div class="card">
<table>
<thead>
<tr>
<th>No</th><th>Name</th><th>Total</th><th>Remaining</th><th>Pending</th><th>View</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>
</div>

<!-- POPUP -->
<div id="popup">
 <div class="popupBox">
  <h3 id="popupTitle"></h3>

  <h4>ðŸ”´ Pending Tags (not done)</h4>
  <textarea id="pendingBox" rows="5"></textarea>

  <h4>ðŸŸ¢ Sent Tags (done)</h4>
  <textarea id="sentBox" rows="5" readonly></textarea>

  <button onclick="copyPending()">Copy Pending</button>
  <button class="gray" onclick="markDone()">DONE</button>
  <button class="danger" onclick="closePopup()">Close</button>
 </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, updateDoc, doc }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyDFymz_wZqg0UnE2ShLsUSvdjG9uUU2N6w",
 authDomain:"hayday-pro-manager.firebaseapp.com",
 projectId:"hayday-pro-manager"
};
const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

/* PRICES */
const SELL_PRICE=4.5;
const COST_PRICE=3;

/* ELEMENTS */
const nameInput=document.getElementById("customerName");
const tagsInput=document.getElementById("tags");
const list=document.getElementById("list");
const stats=document.getElementById("stats");
const popup=document.getElementById("popup");
const pendingBox=document.getElementById("pendingBox");
const sentBox=document.getElementById("sentBox");
const popupTitle=document.getElementById("popupTitle");

/* DATA */
let orders=[],currentIndex=null;

/* HELPERS */
const findOrder=n=>orders.find(o=>o.name.toLowerCase()===n.toLowerCase());

/* FIREBASE */
async function loadOrders(){
 const s=await getDocs(collection(db,"orders"));
 return s.docs.map(d=>({id:d.id,...d.data()}));
}
async function saveOrder(o){const r=await addDoc(collection(db,"orders"),o);o.id=r.id}
async function updateOrder(o){await updateDoc(doc(db,"orders",o.id),o)}

/* RENDER */
function render(){
 let html="",sentTotal=0;
 orders.forEach((o,i)=>{
  sentTotal+=o.sentTags.length;
  html+=`
  <tr>
   <td>${i+1}</td>
   <td>${o.name}</td>
   <td>${o.total}</td>
   <td>${o.remaining}</td>
   <td>${o.pendingTags.length}</td>
   <td><button onclick="viewOrder(${i})">View</button></td>
  </tr>`;
 });
 list.innerHTML=html||"<tr><td colspan=6>No Orders</td></tr>";

 const profit=((sentTotal/100)*SELL_PRICE-(sentTotal/100)*COST_PRICE).toFixed(2);
 stats.innerHTML=`
 <div class="stat"><b>Total Sent:</b> ${sentTotal} tags</div>
 <div class="stat"><b>Profit:</b> ${profit} USDT</div>`;
}

/* ADD TAGS */
document.getElementById("sendBtn").onclick=async()=>{
 const name=nameInput.value.trim();
 if(!name)return alert("Enter customer name");

 let o=findOrder(name);
 if(!o){
  const total=prompt("New customer. Enter total order tags:");
  if(!total)return;
  o={name,total:+total,remaining:+total,sentTags:[],pendingTags:[]};
  await saveOrder(o);
  orders.push(o);
 }

 const arr=tagsInput.value.trim().split(/\r?\n/).filter(Boolean);
 if(arr.length){
  o.pendingTags.push(...arr);
  o.remaining-=arr.length;
  await updateOrder(o);
 }

 nameInput.value="";tagsInput.value="";
 render();
};

/* VIEW */
window.viewOrder=i=>{
 currentIndex=i;
 const o=orders[i];
 popupTitle.innerText=o.name+" | Remaining: "+o.remaining;
 pendingBox.value=o.pendingTags.join("\n");
 sentBox.value=o.sentTags.join("\n");
 popup.style.display="block";
};
window.closePopup=()=>popup.style.display="none";

/* COPY */
window.copyPending=()=>{
 pendingBox.select();
 document.execCommand("copy");
 alert("Pending tags copied");
};

/* DONE */
window.markDone=async()=>{
 const o=orders[currentIndex];
 o.sentTags.push(...o.pendingTags);
 o.pendingTags=[];
 await updateOrder(o);
 closePopup();
 render();
};

/* INIT */
document.addEventListener("DOMContentLoaded",async()=>{
 orders=await loadOrders();
 orders.forEach(o=>{
  if(!o.sentTags)o.sentTags=[];
  if(!o.pendingTags)o.pendingTags=[];
  o.remaining=o.total-(o.sentTags.length+o.pendingTags.length);
 });
 render();
});
</script>

</body>
</html>
